{
    "collab_server" : "",
    "contents" : "#' Likelihoods for M4\n#'\n#' M4\n#'\n#' @importFrom mvtnorm dmvnorm\n#' @export\nloglM4 <- function(pars, dat, finiteonly = TRUE){\n  outcs   <- dat$expression;\n  gts     <- dat$genotype;\n  tot.exp <- dat$tot.exp;\n  tot.gts <- dat$tot.gts;\n\n  ## parameters\n  bxa0     <- exp(pars[1])\n  bxa      <- pars[2]\n  bxi0     <- exp(pars[3])\n  bxi      <- pars[4]\n  besc0    <- pars[5]\n  besc     <- pars[6]\n  varXa    <- exp(pars[7])\n  varXi    <- exp(pars[8])\n  corXaXi  <- exp(pars[9])/(1+exp(pars[9]))\n  covXaXi  <- corXaXi*sqrt(varXa*varXi)\n  omega <- matrix(c(varXa, covXaXi, covXaXi, varXi), ncol = 2)\n  # Add data\n  gamma <- exp(besc0+besc*gts)/(1+exp(besc0+besc*gts))\n  meanmatA <- matrix(c(bxa0+bxa*gts, bxi0+bxi*gts), ncol = 2)\n  meanmatI <- matrix(c(bxa0+bxa*gts, 0*gts), ncol = 2)\n  # Fit\n  la <- dmvnorm(x = outcs-meanmatA, mean = c(0,0), sigma = omega)\n  li <- dmvnorm(x = outcs-meanmatI, mean = c(0,0), sigma = omega)\n  l <- la*gamma + li*(1-gamma)\n  # Samples without Xa/Xi-expression still contain information\n  tot.gamma <- exp(besc0+besc*tot.gts)/(1+exp(besc0+besc*tot.gts));\n  tot.la <- dnorm(tot.exp, mean = bxa0+bxa*tot.gts +\n                                  bxi0+bxi*tot.gts, sd=sqrt(sum(omega)))\n  tot.li <- dnorm(tot.exp, mean = bxa0+bxa*tot.gts, sd=sqrt(sum(omega)))\n  tot.l <- tot.la*tot.gamma + tot.li*(1-tot.gamma);\n\n  # logL <- -sum(log(l))-sum(log(tot.l));\n  logL <- c(log(l), log(tot.l))\n  if(finiteonly){\n    ret <- -sum(logL[is.finite(logL)])\n  } else{\n    ret <- -sum(logL)\n  }\n  return(ret)\n}\n#' @export\nloglM4H0_xi <- function(pars, dat, finiteonly = TRUE) {\n  pars_H0 <- c(pars[1:3],0,pars[4:length(pars)]);\n  return(loglM4(pars_H0, dat=dat, finiteonly = finiteonly))\n}\n#' Model M5\n#'\n#' This is the same model as M4 but with the assumption that bxi = 0. It is used\n#' to test besc = 0 under the assumption that there is no effect on Xi. In a\n#' broader sense, it should find any QTL that affects expression by modifying\n#' escape (chance of escape or amount of escape).\n#'\n#' @export\nloglM5 <- function(pars,dat, finiteonly = TRUE) {\n  return(loglM4H0_xi(pars,dat, finiteonly = finiteonly));\n}\n#' @export\nloglM5H0_esc <- function(pars,dat, finiteonly = TRUE) {\n  pars.full <- c(pars[1:4],0,pars[5:7]);\n  return(loglM5(pars.full, dat, finiteonly = finiteonly))\n}\n\n",
    "created" : 1601397734506.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1169183948",
    "id" : "5E860A9D",
    "lastKnownWriteTime" : 1601398808,
    "last_content_update" : 1601398808763,
    "path" : "/gpfs/group/dxl46/default/private/renan/gits//XQTL/R/likelihoods3.R",
    "project_path" : "R/likelihoods3.R",
    "properties" : {
        "docOutlineVisible" : "1",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}